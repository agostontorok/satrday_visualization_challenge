---
title: "satRday challenge"
author: "Agoston Torok & Fanni Kling"
date: '2016 augusztus 18 '
output: html_document
---

```{r setup, include=FALSE}
#install.packages(pkgs="gdata")
options(java.parameters = "-Xmx4000m")
if (!"xlsx" %in% installed.packages()) install.packages("xlsx")
library("xlsx")

df <- read.xlsx2("BUD flights 2007-2012.xlsx", sheetIndex = 1,
                 colClasses = c(rep("character", 7),
                                "Date",
                                "numeric",
                                rep("character", 3),
                                rep("numeric", 4)))
```

## Map Creation

First let's read the longitude and lattitude coordinates of the the different countries [citation](https://www.r-bloggers.com/r-beginners-plotting-locations-on-to-a-world-map/). 

```{r readLocations}
library(stringi)
if (!"ggmap" %in% installed.packages()) install.packages("ggmap")
library(ggmap)

locationsFileName <- "locations_lon_lat.csv"

if (file.exists(locationsFileName)){
  locationCoordinates <- read.csv(locationsFileName)
} else {
  destinationCountries <- unique(as.character(df$COUNTRY))
  locationCoordinates <- geocode(destinationCountries)
  locationCoordinates$COUNTRY <- destinationCountries
  write.csv(locationCoordinates, locationsFileName)
}

df <- merge(df, locationCoordinates)
```

Then display a world map using the [Mollweide projection](https://en.wikipedia.org/wiki/Mollweide_projection). This projection is used because it emphasizes the accuracy of relative sizes of land and sea parts. The method used here is based on the example and polygon of [Bob Rudis](http://stackoverflow.com/a/27901570/5360901). For the animation we used the [gganimate](https://www.ggplot2-exts.org/gganimate.html) package by David Robinson. 


```{r staticWorldMap}
if (!"sp" %in% installed.packages()) install.packages("sp")
library("sp")
if (!"maps" %in% installed.packages()) install.packages("maps")
library("maps")
if (!"rgdal" %in% installed.packages()) install.packages("rgdal")
library("rgdal")
if (!"rgeos" %in% installed.packages()) install.packages("rgeos")
library("rgeos")
if (!"gganimate" %in% installed.packages()) devtools::install_github("dgrtwo/gganimate")
library(gganimate)


world <- readOGR("ne_50m_admin_0_countries.geojson", "OGRGeoJSON")
outline <- bbox(world)
outline <- data.frame(xmin=outline["x","min"],
                      xmax=outline["x","max"],
                      ymin=outline["y","min"],
                      ymax=outline["y","max"])

world <- fortify(world)

points <- data.frame(lon=c(-98.35, 134.21), lat=c(39.5, -25.36))

gg <- ggplot()
# first let's create the sea
gg <- gg + geom_rect(data=outline, 
                     aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax), 
                     color=1, fill="lightblue", size=0.3)
# then let the land emerge
gg <- gg + geom_map(data=world, map=world,
                    aes(x=long, y=lat, map_id=id), 
                    fill="darkseagreen", color="gray10", size=0.3)
# then let people populate the Earth
gg <- gg + geom_point(aes(x=lon, y=lat, size=CARGO.WEIGHT, frame=DATE),
                      data=df, col="orange", alpha=0.4)
gg <- gg + coord_map("mollweide")

# make the plot pretty
gg <- gg + theme_bw()
gg <- gg + labs(x=NULL, y=NULL)
gg <- gg + theme(panel.grid=element_blank())
gg <- gg + theme(legend.position="none", panel.border=element_blank())
gg <- gg + theme(axis.ticks=element_blank())
gg <- gg + theme(axis.text=element_blank())
gg_animate(gg, saver = "mp4") #, filename="cargo_weight.gif")

```




http://stackoverflow.com/questions/37329433/how-to-build-simple-google-chart-in-shiny

https://trinkerrstuff.wordpress.com/2013/05/11/animations-understood-5/


